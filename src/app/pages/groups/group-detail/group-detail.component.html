<div class="container mx-auto p-4">
  <!-- Back button and group header -->
  <div class="mb-6">
    <button pButton icon="pi pi-arrow-left" class="p-button-text p-button-rounded"
            (click)="goBack()" pTooltip="Back to Groups"></button>
  </div>

  <!-- Group header -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-6">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
      <div class="flex items-center gap-4">
        <img [src]="group?.avatar" [alt]="group?.name"
             class="w-16 h-16 rounded-full object-cover border-2 border-blue-500" />
        <div>
          <h1 class="text-2xl font-bold">{{ group?.name }}</h1>
          <p class="text-gray-600 dark:text-gray-300">{{ group?.description }}</p>
        </div>
      </div>
      <div class="flex gap-2">
        <button pButton label="Add Expense" icon="pi pi-plus"
                class="p-button-primary" (click)="addExpense()"></button>
        <button pButton label="Settle Up" icon="pi pi-check-circle"
                class="p-button-success" (click)="settleUp()"></button>
        <button pButton icon="pi pi-ellipsis-v" class="p-button-rounded p-button-text"
                [pTooltip]="'Group Options'" [showDelay]="1000"
                (click)="menu.toggle($event)"></button>
        <p-menu #menu [model]="menuItems" [popup]="true"></p-menu>
      </div>
    </div>
  </div>

  <!-- Group stats -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold mb-2">Group Balance</h3>
      <div class="text-2xl font-bold"
           [ngClass]="{'text-green-600 dark:text-green-400': group?.balance > 0,
                      'text-red-600 dark:text-red-400': group?.balance < 0,
                      'text-gray-600 dark:text-gray-400': group?.balance === 0}">
        <span *ngIf="group?.balance > 0">You are owed</span>
        <span *ngIf="group?.balance < 0">You owe</span>
        <span *ngIf="group?.balance === 0">Settled up</span>
        <span *ngIf="group?.balance !== 0"> {{ group?.balance | currency }}</span>
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold mb-2">Total Expenses</h3>
      <div class="text-2xl font-bold text-gray-800 dark:text-gray-200">
        {{ group?.totalExpenses | currency }}
      </div>
    </div>

    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
      <h3 class="text-lg font-semibold mb-2">Members</h3>
      <div class="flex items-center">
        <p-avatarGroup styleClass="mb-3">
          <p-avatar *ngFor="let member of members.slice(0, 4)"
                    [image]="member.avatar"
                    size="large"
                    [pTooltip]="member.name"></p-avatar>
        </p-avatarGroup>
        <span class="ml-2 text-gray-600 dark:text-gray-300">{{ group?.memberCount }} members</span>
      </div>
    </div>
  </div>

  <!-- Tabs for Expenses and Members -->
  <p-tabView [(activeIndex)]="activeTabIndex">
    <p-tabPanel header="Expenses">
      <app-expense-list [groupId]="groupId"></app-expense-list>
    </p-tabPanel>
    <p-tabPanel header="Members">
      <app-group-member [groupId]="groupId" [members]="members"></app-group-member>
    </p-tabPanel>
  </p-tabView>

  <!-- Edit Group Dialog -->
  <p-dialog [(visible)]="showEditDialog" [style]="{width: '450px'}"
            header="Edit Group" [modal]="true" styleClass="p-fluid">
    <div class="field mb-4">
      <label for="name" class="block mb-2">Group Name</label>
      <input type="text" pInputText id="name" [(ngModel)]="editedGroup.name" required />
    </div>
    <div class="field mb-4">
      <label for="description" class="block mb-2">Description</label>
      <input type="text" pInputText id="description" [(ngModel)]="editedGroup.description" />
    </div>
    <ng-template pTemplate="footer">
      <button pButton pRipple label="Cancel" icon="pi pi-times"
              class="p-button-text" (click)="showEditDialog = false"></button>
      <button pButton pRipple label="Save" icon="pi pi-check"
              class="p-button-text" (click)="saveGroupChanges()"></button>
    </ng-template>
  </p-dialog>
</div>
