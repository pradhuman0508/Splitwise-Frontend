<div class="contains">
  <p-splitter [panelSizes]="[28, 72]" class="mb-8 min-h-screen" >
    <ng-template pTemplate="panel">
      <div  class="card surface-border rounded-lg shadow-sm p-6 min-h-screen w-full">
        <div class="flex gap-2 items-center mb-4">
           <p-card>
        <div class="flex justify-between items-center mb-2">
        <h2 class="text-lg font-semibold">Recent Activity</h2>
        <button pButton label="View All" icon="pi pi-arrow-right" size="small" class="view-all-btn"></button>
      </div>

      <p class="text-xs text-gray-500 mb-3">Showing your 10 most recent activities</p>
        <div class="flex flex-col">
          <ng-container *ngIf="!isLoading; else skeletonLoader">
            <p-card *ngFor="let activity of activityList" class="mb-3">
              <div class="flex justify-between items-center mb-2">
                <div class="flex items-center gap-2">
                  <p-avatar label="{{ activity.userName[0] }}" shape="circle"
                    styleClass="bg-primary text-white"></p-avatar>
                  <span class="font-medium">{{ activity.userName }}</span>
                </div>
                <small class="text-gray-500">{{ activity.createdAt | date:'medium' }}</small>
              </div>

              <div class="text-xs text-gray-500">
                {{ activity.description }}
              </div>


              <p-divider></p-divider>

              <div class="flex justify-between items-center text-xs text-gray-500">
                <div class="flex flex-col">
                  <span class="ml-3 mb-3" *ngIf="activity.groupName">
                    <i class="pi pi-users mr-1"></i>{{ activity.groupName }}
                  </span>
                  <span *ngIf="activity.expenseName" class="ml-3">
                    <i class="pi pi-wallet mr-1"></i>{{ activity.expenseName }}
                  </span>
                </div>
                <div class="flex flex-col">
                  <!-- Revert button only for DELETE_EXPENSE -->
                  <div *ngIf="activity.actionType === 'DELETE_EXPENSE'" class="mt-2 text-right mb-3">
                    <button pButton label="Revert" icon="pi pi-undo" size="small"
                      styleClass="p-button-text p-button-sm undo-btn" (click)="revertDelete(activity)">
                    </button>
                  </div>
                  <p-tag [severity]="getActionColor(activity.actionType)" value="{{ activity.actionType }}"></p-tag>
                </div>
              </div>
            </p-card>
          </ng-container>

          <ng-template #skeletonLoader>
            <p-card *ngFor="let _ of [1,2,3,4]" class="activity-card mb-3">
              <div class="flex items-center gap-3 mb-2">
                <p-skeleton shape="circle" size="2rem"></p-skeleton>
                <p-skeleton width="6rem"></p-skeleton>
              </div>
              <p-skeleton width="100%" height="0.75rem"></p-skeleton>
              <p-skeleton width="70%" height="0.75rem"></p-skeleton>
            </p-card>
          </ng-template>
        </div>

      </p-card>
        </div>
      </div>
    </ng-template>
    <ng-template pTemplate="panel">
      <div class="w-full">
        <form [formGroup]="searchForm" class="flex gap-2 pb-4">
          <div class="relative w-64">
            <select formControlName="searchCategory"
              class="w-full p-2 surface-border rounded-lg appearance-none pr-8 focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0">
              <option value="all">All Categories</option>
              <option value="friends">Friends</option>
              <option value="groups">Groups</option>
              <option value="expenses">Expenses</option>
            </select>
            <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
              <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 9l-7 7-7-7" />
              </svg>
            </div>
          </div>
          <div class="relative flex-1">
            <input type="text" formControlName="searchQuery" (input)="onSearch()" placeholder="Search..." class="w-full p-2 surface-border rounded-lg pl-10
                focus:outline-none focus:ring-0 focus-visible:outline-none focus-visible:ring-0">
            <div class="absolute inset-y-0 left-0 flex items-center pl-3">
              <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
              </svg>
            </div>
            <button type="button" (click)="resetSearch()"
              class="absolute inset-y-0 right-0 px-3 text-gray-400 hover:text-gray-600" title="Clear search">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12" />
              </svg>
            </button>
          </div>
        </form>

        <div *ngIf="searchResults.length > 0"
          class="absolute mt-2 w-full max-w-2xl rounded-lg shadow-lg z-40 max-h-96 overflow-y-auto">
          <div class="p-4 card">
            <div *ngFor="let result of searchResults" class="py-2">
              <div [ngSwitch]="result.type"
                class="flex items-center justify-between p-2 rounded-lg cursor-pointer hover:bg-[var(--surface-hover)]">
                <div class="flex items-center space-x-3">
                  <img [src]="result.avatar" loading="lazy" class="w-10 h-10 rounded-full" [alt]="result.name">
                  <div>
                    <p class="font-medium">{{result.name}}</p>
                    <p class="text-sm">{{result.type | titlecase}}</p>
                  </div>
                </div>
                <span *ngIf="result.balance !== undefined" class="text-sm font-medium"
                  [ngClass]="{'text-green-600': result.balance > 0, 'text-red-600': result.balance < 0, 'text-gray-600': result.balance === 0}">
                  {{result.balance | currency:'INR':'symbol':'1.2-2'}}
                </span>
              </div>
            </div>
          </div>
        </div>
        <div class="dashboard-container">
          <div class="card">
            <div class="expense-header">
              <h2>Overview</h2>
              <app-add-expense></app-add-expense>
              <button pButton label="Settle Up" severity="success" class="p-button-primary w-full sm:w-auto"></button>
            </div>
            <div class="stats-grid">
              <div class="stat-item"
                [ngClass]="totalExpenses > 0 ? 'hover:bg-green-500/10' : totalExpenses < 0 ? 'hover:bg-red-500/10' : 'hover:bg-gray-500/10'">
                <div class="stat-content">
                  <div class="stat-info">
                    <p class="stat-label">Total Expenses</p>
                    <p class="stat-value"
                      [ngClass]="totalExpenses > 0 ? 'text-green-600' : totalExpenses < 0 ? 'text-red-600' : 'text-gray-600'">
                      {{ (totalExpenses < 0 ? -totalExpenses : totalExpenses) | currency:'INR':'symbol':'1.2-2' }}</p>
                  </div>
                  <div class="stat-icon">
                    <i class="pi pi-wallet"
                      [ngClass]="totalExpenses > 0 ? 'bg-green-500/25 text-green-600' : totalExpenses < 0 ? 'bg-red-500/25 text-red-600' : 'bg-gray-500/25 text-gray-600'"></i>
                  </div>
                </div>
              </div>
              <div class="stat-item owe-item"
                [ngClass]="youOwe < 0 ? 'hover:bg-green-500/10' : youOwe > 0 ? 'hover:bg-red-500/10' : 'hover:bg-gray-500/10'">
                <div class="stat-content">
                  <div class="stat-info">
                    <p class="stat-label">You Owe</p>
                    <p class="stat-value"
                      [ngClass]="youOwe > 0 ? 'text-red-600' : youOwe < 0 ? 'text-green-600' : 'text-gray-600'">
                      {{ youOwe | currency:'INR':'symbol':'1.2-2' }}
                    </p>
                  </div>
                  <div class="stat-icon">
                    <i class="pi pi-angle-double-up"
                      [ngClass]="youOwe < 0 ? 'bg-green-500/25 text-green-600' : youOwe > 0 ? 'bg-red-500/25 text-red-600' : 'bg-gray-500/25 text-gray-600'"></i>
                  </div>
                </div>
              </div>
              <div class="stat-item owed-item"
                [ngClass]="youAreOwed > 0 ? 'hover:bg-green-500/10' : youAreOwed < 0 ? 'hover:bg-red-500/10' : 'hover:bg-gray-500/10'">
                <div class="stat-content">
                  <div class="stat-info">
                    <p class="stat-label">You Are Owed</p>
                    <p class="stat-value"
                      [ngClass]="youAreOwed > 0 ? 'text-green-600' : youAreOwed < 0 ? 'text-red-600' : 'text-gray-600'">
                      {{ youAreOwed | currency:'INR':'symbol':'1.2-2' }}
                    </p>
                  </div>
                  <div class="stat-icon">
                    <i class="pi pi-angle-double-down down-icon"
                      [ngClass]="youAreOwed > 0 ? 'bg-green-500/25 text-green-600' : youAreOwed < 0 ? 'bg-red-500/25 text-red-600' : 'bg-gray-500/25 text-gray-600'"></i>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="membersWhoOweYou && membersWhoOweYou.length > 0; else showGroups"
              class="grid grid-cols-1 lg:grid-cols-2 p-6 divide-x divide-gray-200 dark:divide-gray-700">
              <div class="lg:col-span-1">
                <div class="flex flex-col gap-2">
                  <div class="summary-col1">YOU OWE</div>
                  <div>
                    <div *ngIf="membersYouOwe && membersYouOwe.length > 0; else noOwe">
                      <div *ngFor="let item of membersYouOwe" class="px-6 py-4 hover:bg-gray-400/15">
                        <div class="flex items-start gap-3">
                          <img [src]="item.avatar" [alt]="item.memberName" class="w-10 h-10 rounded-full flex-shrink-0"
                            loading="lazy"
                            onerror="this.src='https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=64'">
                          <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between">
                              <span class="font-medium text-gray-850 dark:text-gray-300"
                                [style]="{fontSize: '1.275rem'}">{{ item.memberName }}</span>
                              <div class="text-red-600">
                                <span class="font-medium">
                                  you owe </span><span class="font-medium" [style]="{fontSize: '1.2rem'}">{{ item.amount
                                  | currency:'INR':'symbol':'1.2-2'
                                  }}</span>
                              </div>
                            </div>
                            <ul class="text-sm pt-1 list-disc list-inside">
                              <li *ngFor="let group of item.groupBreakdown"
                                (click)="navigateToGroupByName(group.groupName)"  class="hover:underline">
                                <span *ngIf="group.amount < 0" class="text-gray-500">
                                  You owe {{ item.memberName }}
                                </span>

                                <span *ngIf="group.amount > 0" class="text-gray-500">
                                  {{ item.memberName }} owes you
                                </span>
                                <span class="font-medium"
                                  [ngClass]="group.amount > 0 ? 'text-green-600' : group.amount < 0 ? 'text-red-600' : 'text-gray-600'">
                                  {{ (group.amount < 0 ? -group.amount : group.amount) | currency:'INR':'symbol':'1.2-2' }}
                                    </span>
                                    <span class="text-gray-400 dark:text-gray-600">for "{{ group.groupName }}"</span>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                    <ng-template #noOwe>
                      <div class="px-6 py-6 text-sm text-gray-600">No outstanding amounts you owe.</div>
                    </ng-template>
                  </div>
                </div>
              </div>
              <div class="lg:col-span-1">
                <div class="flex flex-col gap-2">
                  <div class="summary-col2">YOU ARE OWED</div>
                  <div>
                    <div *ngIf="membersWhoOweYou && membersWhoOweYou.length > 0; else noOwed">
                      <div *ngFor="let item of membersWhoOweYou" class="px-6 py-4 hover:bg-gray-400/15">
                        <div class="flex items-start gap-3">
                          <img [src]="item.avatar" [alt]="item.memberName" class="w-10 h-10 rounded-full flex-shrink-0"
                            loading="lazy"
                            onerror="this.src='https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=64'">
                          <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between">
                              <span class="font-medium text-gray-850 dark:text-gray-300"
                                [style]="{fontSize: '1.275rem'}">{{ item.memberName }}</span>
                              <div class="text-green-600">
                                <span class="font-medium">
                                  owes you </span><span class="font-medium" [style]="{fontSize: '1.2rem'}">{{
                                  item.amount
                                  | currency:'INR':'symbol':'1.2-2'
                                  }}</span>
                              </div>
                            </div>
                            <ul class="text-sm pt-1 list-disc list-inside">
                              <li *ngFor="let group of item.groupBreakdown"
                                (click)="navigateToGroupByName(group.groupName)" class="hover:underline">
                                <span *ngIf="group.amount < 0" class="text-gray-500">
                                  You owe {{ item.memberName }}
                                </span>
                                <span *ngIf="group.amount > 0" class="text-gray-500">
                                  {{ item.memberName }} owes you
                                </span>
                                <span class="font-medium"
                                  [ngClass]="group.amount > 0 ? 'text-green-600' : group.amount < 0 ? 'text-red-600' : 'text-gray-600'">
                                  {{ (group.amount < 0 ? -group.amount : group.amount) | currency:'INR':'symbol':'1.2-2' }}
                                    </span>
                                    <span class="text-gray-400 dark:text-gray-600">for "{{ group.groupName }}"</span>
                              </li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                    <ng-template #noOwed>
                      <div class="px-6 py-6 text-sm text-gray-600">No one owes you currently.</div>
                    </ng-template>
                  </div>
                </div>
              </div>
            </div>
            <ng-template #showGroups>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-3">
                <div class="lg:col-span-1 surface-border rounded-lg shadow-sm p-6">
                  <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold mb-0">Groups</h2>
                  </div>
                  <div class="space-y-3">
                    <ng-container *ngIf="!isLoading; else groupsLoading">
                      <div *ngFor="let group of groups.slice(0, 4)">
                        <p-panel [showHeader]="false"
                          styleClass="shadow-lg hover:shadow-lg transition-shadow duration-900 cursor-pointer"
                          (click)="navigateToGroup(group.id)">
                          <div class="flex items-center justify-between pt-4">
                            <div class="flex items-center space-x-3">
                              <img [src]="group.avatar" loading="lazy" class="w-10 h-10 rounded-full"
                                [alt]="group.name">
                              <div>
                                <p class="font-medium">{{group.name}}</p>
                              </div>
                            </div>
                            <span class="text-sm font-medium"
                              [ngClass]="{'text-green-600': group.balance > 0, 'text-red-600': group.balance < 0}">
                              {{group.balance | currency:'INR':'symbol':'1.2-2'}}
                            </span>
                          </div>
                        </p-panel>
                      </div>
                    </ng-container>
                    <ng-template #groupsLoading>
                      <div *ngFor="let i of [1,2,3,4]" class="p-3 border rounded-lg">
                        <p-skeleton height="4rem"></p-skeleton>
                      </div>
                    </ng-template>
                    <div [routerLink]="['/groups']" class="block text-center text-blue-600 hover:text-blue-800 mt-2">Show More
                      Groups</div>
                  </div>
                </div>
                <div class="lg:col-span-1 surface-border rounded-lg shadow-sm p-6">
                  <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold mb-0">Friends</h2>
                  </div>
                  <div class="space-y-3">
                    <ng-container *ngIf="!isLoading; else friendsLoading">
                      <div *ngFor="let friend of friends.slice(0, 3)">
                        <p-panel [showHeader]="false" styleClass="shadow-lg hover:shadow-lg transition-shadow duration-900 cursor-pointer">
                          <div class="flex items-center justify-between pt-4">
                            <div class="flex items-center space-x-3">
                              <img [src]="friend.avatar" loading="lazy" class="w-10 h-10 rounded-full" [alt]="friend.name">
                              <div>
                                <p class="font-medium mb-0">{{friend.name}}</p>
                                <p class="text-sm text-gray-500">{{friend.email}}</p>
                              </div>
                            </div>
                            <span class="text-sm font-medium"
                              [ngClass]="{'text-green-600': friend.balance > 0, 'text-red-600': friend.balance < 0}">
                              {{friend.balance | currency:'INR':'symbol':'1.2-2'}}
                            </span>
                          </div>
                        </p-panel>
                      </div>
                    </ng-container>
                    <ng-template #friendsLoading>
                      <div *ngFor="let i of [1,2,3]" class="p-3 border rounded-lg">
                        <p-skeleton height="4rem"></p-skeleton>
                      </div>
                    </ng-template>
                    <div [routerLink]="['/friends']" class="block text-center text-blue-600 hover:text-blue-800 mt-2">Show More Friends</div>
                  </div>
                </div>
              </div>
            </ng-template>
          </div>
        </div>
      </div>
    </ng-template>
  </p-splitter>
</div>
<!-- <router-outlet></router-outlet> -->
